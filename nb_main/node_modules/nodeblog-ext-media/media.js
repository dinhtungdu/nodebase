var express = require('express');
var path = require('path');
var app = express();

var path = require('path');
var g = require(path.join(LIBS_DIR, 'global'));

var db = require(path.join(LIBS_DIR, 'db'))();
var nbAppFileUpload = require("express-mongo-busboy")({
    mongoose: db.getMongoose()
});

g.isAcp = true;
app.use(function (req, res, next) {
    if(req.session.userInfo.LEVEL < USER_LEVEL.MEMBER)
        res.redirect('/login');
    else next();
});

app.get('/browse', function(req,res){
    res.json('ok');
});
app.get('/upload', function(req,res){
    var tpl = require('./views/upload.marko');
    res.marko(tpl);
});
app.post('/upload', nbAppFileUpload, function(req,res){
    var returnObj = req.body.files.nbFile;
    returnObj.status = 'OK';
    res.json(returnObj);
    console.log(returnObj);
});
module.exports = app;